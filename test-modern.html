<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RDP Client - ç°ä»£åŒ–æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 900px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .test-result {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }

        .test-result.pass {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .test-result.fail {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #667eea;
        }

        .feature-list li::before {
            content: "âœ“ ";
            color: #28a745;
            font-weight: bold;
            margin-right: 8px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(0);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #eee;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ RDP Client ç°ä»£åŒ–ç‰¹æ€§æµ‹è¯•</h1>
        <p class="subtitle">éªŒè¯ ES6+ ç‰¹æ€§å’Œç°ä»£åŒ–å®ç°</p>

        <div class="test-section">
            <h2>æ ¸å¿ƒç°ä»£åŒ–ç‰¹æ€§</h2>
            <ul class="feature-list">
                <li>ç§æœ‰å­—æ®µ (#field) è¯­æ³•</li>
                <li>ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦ (??)</li>
                <li>Map æ•°æ®ç»“æ„</li>
                <li>Promise / async-await</li>
                <li>ç®­å¤´å‡½æ•°</li>
                <li>æ¨¡æ¿å­—ç¬¦ä¸²</li>
                <li>è§£æ„èµ‹å€¼</li>
                <li>é“¾å¼è°ƒç”¨</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>è‡ªåŠ¨åŒ–æµ‹è¯•ç»“æœ</h2>
            <div id="test-results"></div>
        </div>

        <button onclick="runTests()">è¿è¡Œæµ‹è¯•</button>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="pass-count">0</div>
                <div class="stat-label">é€šè¿‡</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="fail-count">0</div>
                <div class="stat-label">å¤±è´¥</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="total-count">0</div>
                <div class="stat-label">æ€»è®¡</div>
            </div>
        </div>
    </div>

    <script src="rdpclient.js"></script>
    <script>
        let passCount = 0;
        let failCount = 0;

        function addTestResult(message, status) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${status}`;
            resultDiv.textContent = message;
            resultsDiv.appendChild(resultDiv);

            if (status === 'pass') passCount++;
            if (status === 'fail') failCount++;

            updateStats();
        }

        function updateStats() {
            document.getElementById('pass-count').textContent = passCount;
            document.getElementById('fail-count').textContent = failCount;
            document.getElementById('total-count').textContent = passCount + failCount;
        }

        async function runTests() {
            // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
            document.getElementById('test-results').innerHTML = '';
            passCount = 0;
            failCount = 0;

            addTestResult('å¼€å§‹æµ‹è¯•...', 'info');

            // æµ‹è¯• 1: ç±»å®ä¾‹åŒ–
            try {
                const canvas = document.createElement('canvas');
                const client = new RDPClient(canvas, {
                    url: 'ws://test:3000',
                    username: 'test',
                    password: 'test'
                });
                addTestResult('âœ“ ç±»å®ä¾‹åŒ–æˆåŠŸ', 'pass');
            } catch (error) {
                addTestResult('âœ— ç±»å®ä¾‹åŒ–å¤±è´¥: ' + error.message, 'fail');
            }

            // æµ‹è¯• 2: é“¾å¼è°ƒç”¨
            try {
                const canvas = document.createElement('canvas');
                const client = new RDPClient(canvas, {
                    url: 'ws://test:3000',
                    username: 'test',
                    password: 'test'
                });
                
                const result = client.on('connected', () => {})
                                     .on('disconnected', () => {})
                                     .on('error', () => {});
                
                if (result === client) {
                    addTestResult('âœ“ é“¾å¼è°ƒç”¨æ”¯æŒæ­£å¸¸', 'pass');
                } else {
                    addTestResult('âœ— é“¾å¼è°ƒç”¨ä¸è¿”å›å®ä¾‹', 'fail');
                }
            } catch (error) {
                addTestResult('âœ— é“¾å¼è°ƒç”¨æµ‹è¯•å¤±è´¥: ' + error.message, 'fail');
            }

            // æµ‹è¯• 3: ç§æœ‰å­—æ®µï¼ˆæ— æ³•ç›´æ¥æµ‹è¯•ï¼Œä½†å¯ä»¥éªŒè¯å…¬å…±APIï¼‰
            try {
                const canvas = document.createElement('canvas');
                const client = new RDPClient(canvas, {
                    url: 'ws://test:3000',
                    username: 'test',
                    password: 'test'
                });

                // ç§æœ‰å­—æ®µä¸åº”è¯¥èƒ½ä»å¤–éƒ¨è®¿é—®
                const hasPrivateField = client['#wasm'] === undefined && 
                                       client['#client'] === undefined &&
                                       client['#socket'] === undefined;
                
                if (hasPrivateField) {
                    addTestResult('âœ“ ç§æœ‰å­—æ®µå°è£…æ­£ç¡®', 'pass');
                } else {
                    addTestResult('âœ— ç§æœ‰å­—æ®µå¯èƒ½æ³„æ¼', 'fail');
                }
            } catch (error) {
                addTestResult('âœ— ç§æœ‰å­—æ®µæµ‹è¯•å¤±è´¥: ' + error.message, 'fail');
            }

            // æµ‹è¯• 4: ç©ºå€¼åˆå¹¶ï¼ˆæµ‹è¯•é»˜è®¤å‚æ•°ï¼‰
            try {
                const canvas = document.createElement('canvas');
                const client = new RDPClient(canvas, {
                    url: 'ws://test:3000',
                    username: 'test',
                    password: 'test'
                    // ä¸æä¾›å¯é€‰å‚æ•°ï¼Œåº”è¯¥ä½¿ç”¨é»˜è®¤å€¼
                });

                if (client.width === 800 && client.height === 600) {
                    addTestResult('âœ“ é»˜è®¤å€¼å¤„ç†æ­£ç¡®ï¼ˆç©ºå€¼åˆå¹¶ï¼‰', 'pass');
                } else {
                    addTestResult('âœ— é»˜è®¤å€¼ä¸æ­£ç¡®', 'fail');
                }
            } catch (error) {
                addTestResult('âœ— é»˜è®¤å€¼æµ‹è¯•å¤±è´¥: ' + error.message, 'fail');
            }

            // æµ‹è¯• 5: äº‹ä»¶ç³»ç»Ÿï¼ˆä½¿ç”¨Mapï¼‰
            try {
                const canvas = document.createElement('canvas');
                const client = new RDPClient(canvas, {
                    url: 'ws://test:3000',
                    username: 'test',
                    password: 'test'
                });

                let eventFired = false;
                const handler = () => { eventFired = true; };
                
                client.on('test-event', handler);
                client._emit('test-event');
                
                if (eventFired) {
                    addTestResult('âœ“ äº‹ä»¶ç³»ç»Ÿå·¥ä½œæ­£å¸¸', 'pass');
                    
                    // æµ‹è¯•äº‹ä»¶ç§»é™¤
                    eventFired = false;
                    client.off('test-event', handler);
                    client._emit('test-event');
                    
                    if (!eventFired) {
                        addTestResult('âœ“ äº‹ä»¶ç§»é™¤åŠŸèƒ½æ­£å¸¸', 'pass');
                    } else {
                        addTestResult('âœ— äº‹ä»¶ç§»é™¤å¤±è´¥', 'fail');
                    }
                } else {
                    addTestResult('âœ— äº‹ä»¶æœªè§¦å‘', 'fail');
                }
            } catch (error) {
                addTestResult('âœ— äº‹ä»¶ç³»ç»Ÿæµ‹è¯•å¤±è´¥: ' + error.message, 'fail');
            }

            // æµ‹è¯• 6: å‚æ•°éªŒè¯
            try {
                const canvas = document.createElement('canvas');
                let errorCaught = false;
                
                try {
                    new RDPClient(canvas, {
                        // ç¼ºå°‘å¿…éœ€å‚æ•°
                        username: 'test'
                    });
                } catch (e) {
                    errorCaught = true;
                }
                
                if (errorCaught) {
                    addTestResult('âœ“ å‚æ•°éªŒè¯å·¥ä½œæ­£å¸¸', 'pass');
                } else {
                    addTestResult('âœ— å‚æ•°éªŒè¯æœªæ•è·é”™è¯¯', 'fail');
                }
            } catch (error) {
                addTestResult('âœ— å‚æ•°éªŒè¯æµ‹è¯•å¤±è´¥: ' + error.message, 'fail');
            }

            // æµ‹è¯• 7: è‡ªåŠ¨é‡è¿é…ç½®
            try {
                const canvas = document.createElement('canvas');
                const client = new RDPClient(canvas, {
                    url: 'ws://test:3000',
                    username: 'test',
                    password: 'test',
                    autoReconnect: true,
                    maxReconnectAttempts: 5
                });

                if (client.autoReconnect === true) {
                    addTestResult('âœ“ è‡ªåŠ¨é‡è¿é…ç½®ç”Ÿæ•ˆ', 'pass');
                } else {
                    addTestResult('âœ— è‡ªåŠ¨é‡è¿é…ç½®å¤±è´¥', 'fail');
                }
            } catch (error) {
                addTestResult('âœ— è‡ªåŠ¨é‡è¿æµ‹è¯•å¤±è´¥: ' + error.message, 'fail');
            }

            // æµ‹è¯• 8: å…¬å…± API å¯ç”¨æ€§
            try {
                const canvas = document.createElement('canvas');
                const client = new RDPClient(canvas, {
                    url: 'ws://test:3000',
                    username: 'test',
                    password: 'test'
                });

                const hasRequiredMethods = 
                    typeof client.initialize === 'function' &&
                    typeof client.connect === 'function' &&
                    typeof client.disconnect === 'function' &&
                    typeof client.on === 'function' &&
                    typeof client.off === 'function' &&
                    typeof client.isConnected === 'function';

                if (hasRequiredMethods) {
                    addTestResult('âœ“ å…¬å…± API å®Œæ•´', 'pass');
                } else {
                    addTestResult('âœ— å…¬å…± API ä¸å®Œæ•´', 'fail');
                }
            } catch (error) {
                addTestResult('âœ— API æµ‹è¯•å¤±è´¥: ' + error.message, 'fail');
            }

            addTestResult('æµ‹è¯•å®Œæˆï¼', 'info');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>
